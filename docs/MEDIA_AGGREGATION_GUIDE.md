# NipaPlay åª’ä½“åº“å¤§ä¸€ç»Ÿèšåˆæ–¹æ¡ˆ

## æ¦‚è¿°

NipaPlayä¸ä»…æ˜¯ç‹¬ç«‹çš„åª’ä½“æœåŠ¡å™¨ï¼Œæ›´æ˜¯ä¸€ä¸ª**åª’ä½“åº“èšåˆä¸­å¿ƒ**ï¼Œå¯ä»¥åœ¨ç»Ÿä¸€ç•Œé¢ä¸­æ•´åˆå’Œç®¡ç†æ¥è‡ªä¸åŒæºçš„åª’ä½“åº“ï¼Œå®ç°çœŸæ­£çš„"å¤šæºå¤§ä¸€ç»Ÿ"ã€‚

## èšåˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NipaPlay èšåˆä¸­å¿ƒ                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ç»Ÿä¸€ Web ç•Œé¢                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚æœ¬åœ°åª’ä½“ â”‚ â”‚æœ‹å‹çš„åº“ â”‚ â”‚ äº‘å­˜å‚¨  â”‚ â”‚ Plexåº“  â”‚ â”‚Jellyfin â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    èšåˆæœåŠ¡å±‚                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              åª’ä½“åº“é€‚é…å™¨ (Adapters)                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚æœ¬åœ°é€‚é… â”‚ â”‚ç½‘ç»œé€‚é… â”‚ â”‚äº‘å­˜å‚¨é€‚é…â”‚ â”‚ Plex APIâ”‚ â”‚Emby APIâ”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ APIè°ƒç”¨         â†“ ç½‘ç»œè®¿é—®        â†“ APIè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬åœ° NAS      â”‚ â”‚  æœ‹å‹å®¶ NAS     â”‚ â”‚     ç¬¬ä¸‰æ–¹åª’ä½“æœåŠ¡           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æœ¬åœ°æ–‡ä»¶    â”‚ â”‚ â”‚ â”‚NipaPlayæœåŠ¡ â”‚ â”‚ â”‚ â”‚  Plex   â”‚ â”‚  Jellyfin   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ”¯æŒçš„åª’ä½“æºç±»å‹

### 1. æœ¬åœ°åª’ä½“æº
- **æœ¬åœ°æ–‡ä»¶å¤¹**: ç›´æ¥æ‰«ææœ¬åœ°ç›®å½•
- **ç½‘ç»œå…±äº«**: SMB/NFSæŒ‚è½½ç‚¹
- **å¤–æ¥å­˜å‚¨**: USBç¡¬ç›˜ã€ç§»åŠ¨ç¡¬ç›˜

### 2. è¿œç¨‹NipaPlayå®ä¾‹
- **æœ‹å‹å®¶çš„NipaPlay**: é€šè¿‡APIäº’è”
- **å¤šå°è®¾å¤‡**: å®¶é‡Œå¤šå°NAS/æœåŠ¡å™¨
- **åˆ†å¸ƒå¼å­˜å‚¨**: ä¸åŒä½ç½®çš„å­˜å‚¨è®¾å¤‡

### 3. ç¬¬ä¸‰æ–¹åª’ä½“æœåŠ¡
- **Plex Media Server**: é€šè¿‡Plex API
- **Jellyfin**: é€šè¿‡Jellyfin API  
- **Emby**: é€šè¿‡Emby API
- **Kodi**: é€šè¿‡JSON-RPC API

### 4. äº‘å­˜å‚¨æœåŠ¡
- **é˜¿é‡Œäº‘ç›˜**: é€šè¿‡å®˜æ–¹API
- **ç™¾åº¦ç½‘ç›˜**: é€šè¿‡APIæˆ–WebDAV
- **OneDrive**: é€šè¿‡Microsoft Graph API
- **Google Drive**: é€šè¿‡Google Drive API

### 5. åœ¨çº¿åª’ä½“æº
- **IPTVç›´æ’­æº**: M3U8æ’­æ”¾åˆ—è¡¨
- **ç½‘ç»œç”µå°**: éŸ³é¢‘æµåª’ä½“
- **YouTube**: é€šè¿‡yt-dlpé›†æˆ
- **Bilibili**: é€šè¿‡APIé›†æˆ

## æŠ€æœ¯å®ç°

### 1. é€‚é…å™¨æ¶æ„

#### åŸºç¡€é€‚é…å™¨æ¥å£
```dart
// lib/adapters/base_media_adapter.dart
abstract class BaseMediaAdapter {
  String get adapterName;
  String get adapterType;
  bool get isOnline;
  
  // åŸºç¡€åŠŸèƒ½
  Future<bool> connect();
  Future<void> disconnect();
  Future<bool> testConnection();
  
  // åª’ä½“åº“æ“ä½œ
  Future<List<MediaLibrary>> getLibraries();
  Future<List<MediaItem>> getLibraryItems(String libraryId);
  Future<MediaItem?> getItemDetails(String itemId);
  
  // æœç´¢åŠŸèƒ½
  Future<List<MediaItem>> search(String query);
  
  // æ’­æ”¾åŠŸèƒ½
  Future<String> getPlayUrl(String itemId);
  Future<List<Subtitle>> getSubtitles(String itemId);
  
  // å…ƒæ•°æ®
  Future<MediaMetadata> getMetadata(String itemId);
}
```

#### æœ¬åœ°æ–‡ä»¶é€‚é…å™¨
```dart
// lib/adapters/local_file_adapter.dart
class LocalFileAdapter extends BaseMediaAdapter {
  final String basePath;
  
  LocalFileAdapter(this.basePath);
  
  @override
  String get adapterName => "æœ¬åœ°æ–‡ä»¶";
  
  @override
  Future<List<MediaLibrary>> getLibraries() async {
    // æ‰«ææœ¬åœ°ç›®å½•ç»“æ„
    return await _scanLocalDirectories();
  }
  
  @override
  Future<String> getPlayUrl(String itemId) async {
    // è¿”å›æœ¬åœ°æ–‡ä»¶è·¯å¾„æˆ–HTTPæœåŠ¡URL
    return "file://$basePath/$itemId";
  }
}
```

#### Plexé€‚é…å™¨
```dart
// lib/adapters/plex_adapter.dart
class PlexAdapter extends BaseMediaAdapter {
  final String serverUrl;
  final String token;
  
  PlexAdapter(this.serverUrl, this.token);
  
  @override
  String get adapterName => "PlexæœåŠ¡å™¨";
  
  @override
  Future<List<MediaLibrary>> getLibraries() async {
    final response = await http.get(
      Uri.parse('$serverUrl/library/sections'),
      headers: {'X-Plex-Token': token}
    );
    
    return _parsePlexLibraries(response.body);
  }
  
  @override
  Future<String> getPlayUrl(String itemId) async {
    return '$serverUrl/video/:/transcode/universal/start?path=/library/metadata/$itemId';
  }
}
```

#### Jellyfiné€‚é…å™¨
```dart
// lib/adapters/jellyfin_adapter.dart
class JellyfinAdapter extends BaseMediaAdapter {
  final String serverUrl;
  final String apiKey;
  
  JellyfinAdapter(this.serverUrl, this.apiKey);
  
  @override
  String get adapterName => "JellyfinæœåŠ¡å™¨";
  
  @override
  Future<List<MediaLibrary>> getLibraries() async {
    final response = await http.get(
      Uri.parse('$serverUrl/Library/VirtualFolders'),
      headers: {'Authorization': 'MediaBrowser Token="$apiKey"'}
    );
    
    return _parseJellyfinLibraries(response.body);
  }
}
```

#### äº‘å­˜å‚¨é€‚é…å™¨
```dart
// lib/adapters/cloud_storage_adapter.dart
class AliyunDriveAdapter extends BaseMediaAdapter {
  final String refreshToken;
  String? accessToken;
  
  @override
  String get adapterName => "é˜¿é‡Œäº‘ç›˜";
  
  @override
  Future<List<MediaLibrary>> getLibraries() async {
    await _refreshAccessToken();
    // è·å–äº‘ç›˜æ–‡ä»¶åˆ—è¡¨
    return await _getCloudFiles();
  }
  
  @override
  Future<String> getPlayUrl(String itemId) async {
    // è·å–äº‘ç›˜æ–‡ä»¶çš„ä¸‹è½½é“¾æ¥
    return await _getDownloadUrl(itemId);
  }
}
```

### 2. åª’ä½“åº“ç®¡ç†å™¨

```dart
// lib/services/media_aggregation_service.dart
class MediaAggregationService {
  final List<BaseMediaAdapter> _adapters = [];
  final Map<String, List<MediaItem>> _cachedItems = {};
  
  // æ³¨å†Œé€‚é…å™¨
  void registerAdapter(BaseMediaAdapter adapter) {
    _adapters.add(adapter);
  }
  
  // è·å–æ‰€æœ‰åª’ä½“åº“
  Future<List<AggregatedLibrary>> getAllLibraries() async {
    final allLibraries = <AggregatedLibrary>[];
    
    for (final adapter in _adapters) {
      try {
        final libraries = await adapter.getLibraries();
        for (final lib in libraries) {
          allLibraries.add(AggregatedLibrary(
            id: '${adapter.adapterName}_${lib.id}',
            name: '${lib.name} (${adapter.adapterName})',
            adapter: adapter,
            originalLibrary: lib,
          ));
        }
      } catch (e) {
        print('è·å– ${adapter.adapterName} åª’ä½“åº“å¤±è´¥: $e');
      }
    }
    
    return allLibraries;
  }
  
  // èšåˆæœç´¢
  Future<List<MediaItem>> aggregatedSearch(String query) async {
    final results = <MediaItem>[];
    
    await Future.wait(_adapters.map((adapter) async {
      try {
        final items = await adapter.search(query);
        results.addAll(items.map((item) => item.copyWith(
          sourceAdapter: adapter.adapterName
        )));
      } catch (e) {
        print('åœ¨ ${adapter.adapterName} ä¸­æœç´¢å¤±è´¥: $e');
      }
    }));
    
    return results;
  }
  
  // æ™ºèƒ½æ¨è
  Future<List<MediaItem>> getRecommendations() async {
    // åŸºäºè§‚çœ‹å†å²ä»æ‰€æœ‰æºæ¨èå†…å®¹
    return await _generateCrossSourceRecommendations();
  }
}
```

### 3. ç»Ÿä¸€ç•Œé¢è®¾è®¡

#### èšåˆåª’ä½“åº“é¡µé¢
```dart
// lib/pages/aggregated_library_page.dart
class AggregatedLibraryPage extends StatefulWidget {
  @override
  _AggregatedLibraryPageState createState() => _AggregatedLibraryPageState();
}

class _AggregatedLibraryPageState extends State<AggregatedLibraryPage> {
  final MediaAggregationService _aggregationService = MediaAggregationService();
  List<AggregatedLibrary> _libraries = [];
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Column(
        children: [
          // åª’ä½“æºé€‰æ‹©å™¨
          _buildSourceSelector(),
          
          // èšåˆæœç´¢æ 
          _buildAggregatedSearchBar(),
          
          // åª’ä½“åº“ç½‘æ ¼
          Expanded(
            child: GridView.builder(
              gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                crossAxisCount: _getGridCrossAxisCount(),
                childAspectRatio: 0.7,
              ),
              itemCount: _libraries.length,
              itemBuilder: (context, index) {
                return _buildLibraryCard(_libraries[index]);
              },
            ),
          ),
        ],
      ),
    );
  }
  
  Widget _buildSourceSelector() {
    return Container(
      height: 60,
      child: ListView.builder(
        scrollDirection: Axis.horizontal,
        itemCount: _aggregationService.adapters.length,
        itemBuilder: (context, index) {
          final adapter = _aggregationService.adapters[index];
          return _buildSourceChip(adapter);
        },
      ),
    );
  }
  
  Widget _buildLibraryCard(AggregatedLibrary library) {
    return Card(
      child: Column(
        children: [
          // åº“å°é¢
          Expanded(
            child: _buildLibraryCover(library),
          ),
          
          // åº“ä¿¡æ¯
          Padding(
            padding: EdgeInsets.all(8),
            child: Column(
              children: [
                Text(library.name, locale:Locale("zh","CN"),
style: TextStyle(fontWeight: FontWeight.bold)),
                Text(library.adapter.adapterName, 
                     locale:Locale("zh","CN"),
style: TextStyle(color: Colors.grey, fontSize: 12)),
                // è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨
                _buildConnectionStatus(library.adapter),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
```

### 4. é…ç½®ç®¡ç†

#### åª’ä½“æºé…ç½®
```dart
// lib/models/media_source_config.dart
class MediaSourceConfig {
  final String id;
  final String name;
  final MediaSourceType type;
  final Map<String, dynamic> config;
  final bool enabled;
  
  const MediaSourceConfig({
    required this.id,
    required this.name,
    required this.type,
    required this.config,
    this.enabled = true,
  });
}

enum MediaSourceType {
  local,
  plex,
  jellyfin,
  emby,
  nipaplay,
  aliyunDrive,
  baiduPan,
  iptv,
}
```

#### è®¾ç½®é¡µé¢
```dart
// lib/pages/settings/media_sources_page.dart
class MediaSourcesPage extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return ListView(
      children: [
        // æ·»åŠ åª’ä½“æºæŒ‰é’®
        ListTile(
          title: Text("æ·»åŠ åª’ä½“æº"),
          leading: Icon(Icons.add),
          onTap: _showAddSourceDialog,
        ),
        
        Divider(),
        
        // å·²é…ç½®çš„åª’ä½“æºåˆ—è¡¨
        ..._buildSourcesList(),
        
        Divider(),
        
        // èšåˆè®¾ç½®
        SwitchListTile(
          title: Text("å¯ç”¨è·¨æºæœç´¢"),
          subtitle: Text("åœ¨æ‰€æœ‰åª’ä½“æºä¸­åŒæ—¶æœç´¢"),
          value: _crossSourceSearchEnabled,
          onChanged: _toggleCrossSourceSearch,
        ),
        
        SwitchListTile(
          title: Text("æ™ºèƒ½æ¨è"),
          subtitle: Text("åŸºäºæ‰€æœ‰æºçš„è§‚çœ‹å†å²æ¨èå†…å®¹"),
          value: _smartRecommendationEnabled,
          onChanged: _toggleSmartRecommendation,
        ),
      ],
    );
  }
}
```

## é«˜çº§åŠŸèƒ½

### 1. è·¨æºæ’­æ”¾åˆ—è¡¨
```dart
// ç”¨æˆ·å¯ä»¥åˆ›å»ºåŒ…å«ä¸åŒæºå†…å®¹çš„æ’­æ”¾åˆ—è¡¨
class CrossSourcePlaylist {
  final String id;
  final String name;
  final List<PlaylistItem> items;
  
  // æ’­æ”¾åˆ—è¡¨é¡¹å¯èƒ½æ¥è‡ªä¸åŒçš„é€‚é…å™¨
  class PlaylistItem {
    final String itemId;
    final BaseMediaAdapter adapter;
    final MediaItem metadata;
  }
}
```

### 2. ç»Ÿä¸€è§‚çœ‹å†å²
```dart
// ä¸ç®¡ä»å“ªä¸ªæºè§‚çœ‹ï¼Œéƒ½è®°å½•åœ¨ç»Ÿä¸€çš„å†å²ä¸­
class UnifiedWatchHistory {
  final String itemId;
  final String sourceAdapter;
  final DateTime watchTime;
  final Duration position;
  final MediaItem metadata;
}
```

### 3. æ™ºèƒ½å»é‡
```dart
// è¯†åˆ«ä¸åŒæºä¸­çš„ç›¸åŒå†…å®¹
class ContentDeduplicator {
  Future<List<MediaItem>> deduplicateItems(List<MediaItem> items) async {
    // åŸºäºæ–‡ä»¶åã€æ—¶é•¿ã€å¤§å°ç­‰ç‰¹å¾è¯†åˆ«é‡å¤å†…å®¹
    return await _performDeduplication(items);
  }
}
```

### 4. è´Ÿè½½å‡è¡¡
```dart
// è‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„æ’­æ”¾æº
class PlaybackSourceSelector {
  Future<String> selectBestPlayUrl(List<String> availableUrls) async {
    // åŸºäºç½‘ç»œå»¶è¿Ÿã€å¸¦å®½ã€æœåŠ¡å™¨è´Ÿè½½é€‰æ‹©æœ€ä½³æº
    return await _selectOptimalSource(availableUrls);
  }
}
```

## ä½¿ç”¨åœºæ™¯

### å®¶åº­åœºæ™¯
```
å®¢å…ç”µè§†: "æˆ‘æƒ³çœ‹ç”µå½±"
â”œâ”€â”€ æœ¬åœ°NAS: å®¶åº­æ”¶è—çš„é«˜æ¸…ç”µå½±
â”œâ”€â”€ æœ‹å‹åˆ†äº«: æœ‹å‹å®¶NASçš„æœ€æ–°ç”µå½±
â”œâ”€â”€ PlexæœåŠ¡å™¨: æœ‹å‹æ¨èçš„Plexå†…å®¹
â””â”€â”€ äº‘ç›˜: ä¸´æ—¶ä¸‹è½½çš„ç”µå½±èµ„æº
```

### ç¤¾äº¤åˆ†äº«
```
æœ‹å‹åœˆåª’ä½“åˆ†äº«:
ç”¨æˆ·A: åˆ†äº«è‡ªå·±NASä¸Šçš„åŠ¨æ¼«æ”¶è—
ç”¨æˆ·B: æ·»åŠ Açš„åª’ä½“åº“åˆ°è‡ªå·±çš„èšåˆåˆ—è¡¨
ç”¨æˆ·C: é€šè¿‡Bå‘ç°Açš„æ”¶è—ï¼Œä¹Ÿç”³è¯·æ·»åŠ 
â†’ å½¢æˆåª’ä½“å†…å®¹ç¤¾äº¤ç½‘ç»œ
```

### å¤šè®¾å¤‡åŒæ­¥
```
å®¶é‡Œ: ä¸»NAS + å®¢å…ç›’å­ + å§å®¤ç”µè§†
å…¬å¸: åŠå…¬å®¤NAS
äº‘ç«¯: å¤‡ä»½å’Œä¸´æ—¶å­˜å‚¨
â†’ åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½è®¿é—®å®Œæ•´çš„åª’ä½“åº“
```

## ä¼˜åŠ¿æ€»ç»“

### 1. ç”¨æˆ·ä½“éªŒ
- **ä¸€ç«™å¼è®¿é—®**: ä¸€ä¸ªç•Œé¢ç®¡ç†æ‰€æœ‰åª’ä½“
- **æ— ç¼åˆ‡æ¢**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ’­æ”¾æº
- **æ™ºèƒ½æ¨è**: è·¨æºå†…å®¹å‘ç°

### 2. æŠ€æœ¯ä¼˜åŠ¿
- **é«˜å¯ç”¨æ€§**: å•æºæ•…éšœä¸å½±å“æ•´ä½“ä½¿ç”¨
- **è´Ÿè½½åˆ†æ•£**: è‡ªåŠ¨è´Ÿè½½å‡è¡¡
- **æ’ä»¶åŒ–**: æ˜“äºæ‰©å±•æ–°çš„åª’ä½“æº

### 3. ç¤¾äº¤ä»·å€¼
- **å†…å®¹åˆ†äº«**: æœ‹å‹é—´åª’ä½“åº“äº’é€š
- **å‘ç°æœºåˆ¶**: é€šè¿‡ç¤¾äº¤ç½‘ç»œå‘ç°æ–°å†…å®¹
- **åä½œç®¡ç†**: å¤šäººå…±åŒç»´æŠ¤åª’ä½“åº“

è¿™æ ·ï¼ŒNipaPlayå°±æˆä¸ºäº†çœŸæ­£çš„**åª’ä½“å®‡å®™ä¸­å¿ƒ**ï¼Œè¿æ¥ä¸€åˆ‡åª’ä½“èµ„æºï¼ğŸŒŒ 